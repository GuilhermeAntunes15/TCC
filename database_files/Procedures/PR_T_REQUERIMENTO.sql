DROP PROCEDURE IF EXISTS PR_T_REQUERIMENTO_DELETE;

DELIMITER $$

CREATE PROCEDURE PR_T_REQUERIMENTO_DELETE

(

IN _CD_REQUERIMENTO int(11),

IN _REQ_DS_AUDITORIA_LOGIN text,

IN _REQ_DT_AUDITORIA_ALTERACAO datetime

)

BEGIN

DECLARE errno INT;

DECLARE EXIT HANDLER FOR SQLEXCEPTION

BEGIN

	GET CURRENT DIAGNOSTICS CONDITION 1 errno = MYSQL_ERRNO;

	SELECT errno AS MYSQL_ERROR;

	ROLLBACK;

END;



START TRANSACTION;



UPDATE T_REQUERIMENTO

SET

    REQ_FL_REQUERIMENTO_ATIVO_SN = 'N',

    REQ_DS_AUDITORIA_LOGIN = _REQ_DS_AUDITORIA_LOGIN,

	REQ_DT_AUDITORIA_ALTERACAO = _REQ_DT_AUDITORIA_ALTERACAO

WHERE

    CD_REQUERIMENTO = _CD_REQUERIMENTO;

    

COMMIT WORK;



END$$

DELIMITER ;



DROP PROCEDURE IF EXISTS PR_T_REQUERIMENTO_UPDATE;



DELIMITER $$

CREATE PROCEDURE PR_T_REQUERIMENTO_UPDATE

(
IN _CD_REQUERIMENTO int(11),
IN _REQ_NOME varchar(100),
IN _REQ_DESCRICAO varchar(100),
IN _REQ_FL_REQUERIMENTO_ATIVO_SN char(1),
IN _REQ_DT_AUDITORIA_ALTERACAO datetime,
IN _REQ_DS_AUDITORIA_LOGIN text

)

BEGIN

DECLARE errno INT;



DECLARE EXIT HANDLER FOR SQLEXCEPTION

BEGIN

	GET CURRENT DIAGNOSTICS CONDITION 1 errno = MYSQL_ERRNO;

	SELECT errno AS MYSQL_ERROR;

	ROLLBACK;

END;



START TRANSACTION;



UPDATE T_REQUERIMENTO

SET
REQ_NOME = _REQ_NOME,
REQ_DESCRICAO = _REQ_DESCRICAO,
REQ_FL_REQUERIMENTO_ATIVO_SN = _REQ_FL_REQUERIMENTO_ATIVO_SN,
REQ_DT_AUDITORIA_ALTERACAO = _REQ_DT_AUDITORIA_ALTERACAO,
REQ_DS_AUDITORIA_LOGIN = _REQ_DS_AUDITORIA_LOGIN

WHERE

    CD_REQUERIMENTO = _CD_REQUERIMENTO;

    

COMMIT WORK;



END$$

DELIMITER ;



DROP PROCEDURE IF EXISTS PR_T_REQUERIMENTO_INSERT;



DELIMITER $$

CREATE PROCEDURE PR_T_REQUERIMENTO_INSERT

(

OUT _CD_REQUERIMENTO int(11),
IN _REQ_NOME varchar(100),
IN _REQ_DESCRICAO varchar(100),
IN _REQ_FL_REQUERIMENTO_ATIVO_SN char(1),
IN _REQ_DT_AUDITORIA_ALTERACAO datetime,
IN _REQ_DS_AUDITORIA_LOGIN text

)

BEGIN

DECLARE errno INT;



DECLARE EXIT HANDLER FOR SQLEXCEPTION

BEGIN

	GET CURRENT DIAGNOSTICS CONDITION 1 errno = MYSQL_ERRNO;

	SELECT errno AS MYSQL_ERROR;

	ROLLBACK;

END;



START TRANSACTION;



INSERT INTO T_REQUERIMENTO

(
REQ_NOME,
REQ_DESCRICAO,
REQ_FL_REQUERIMENTO_ATIVO_SN,
REQ_DT_AUDITORIA_ALTERACAO,
REQ_DS_AUDITORIA_LOGIN

)

VALUES

(
_REQ_NOME,
_REQ_DESCRICAO,
_REQ_FL_REQUERIMENTO_ATIVO_SN,
_REQ_DT_AUDITORIA_ALTERACAO,
_REQ_DS_AUDITORIA_LOGIN

);



COMMIT WORK;

SET

	_CD_REQUERIMENTO = LAST_INSERT_ID();



END$$

DELIMITER ;
